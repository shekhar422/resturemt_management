{% extends "base.html" %}
{% load static %}

{% block body %}
<div class="container">

  <!-- Carousel -->
  <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators">
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active"></button>
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1"></button>
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2"></button>
    </div>
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="{% static 'img/1.jpg' %}" class="d-block w-100" height="400" alt="Slide 1">
        <div class="carousel-caption d-none d-md-block">
          <h5>First slide label</h5>
          <p>Some representative placeholder content for the first slide.</p>
        </div>
      </div>
      <div class="carousel-item">
        <img src="{% static 'img/2.jpg' %}" class="d-block w-100" height="400" alt="Slide 2">
        <div class="carousel-caption d-none d-md-block">
          <h5>Second slide label</h5>
          <p>Some representative placeholder content for the second slide.</p>
        </div>
      </div>
      <div class="carousel-item">
        <img src="{% static 'img/4.jpg' %}" class="d-block w-100" height="400" alt="Slide 3">
        <div class="carousel-caption d-none d-md-block">
          <h5>Third slide label</h5>
          <p>Some representative placeholder content for the third slide.</p>
        </div>
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</div>

<!-- Menu Buttons -->
<div class="center-wrapper" style="margin-top:20px;">
  <div class="box-container">
    <div class="box" onclick="showMenu('veg')">Veg Menu</div>
    <div class="box" onclick="showMenu('nonveg')">Non-Veg Menu</div>
    <div class="box" onclick="showMenu('dessert')">Dessert</div>
    <div class="box" onclick="showMenu('colddrink')">Cold Drink</div>
  </div>

  <!-- Menus -->
  {% for category, items in menus.items %}
  <div id="{{ category }}" class="menu" style="display:none; margin-top:20px;">
    <h3>{{ category|title }} Menu</h3>
    {% for item in items %}
    <div class="menu-item" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
      <div class="item-details">
        <h4>{{ item.dish }}</h4>
        <p>₹{{ item.price }}</p>
      </div>
      <button class="order-btn" onclick="addToCart('{{ item.dish }}', '{{ item.price }}')">Add to Order</button>
    </div>
    {% endfor %}
  </div>
  {% endfor %}
</div>

<!-- Cart -->
<div id="cart-footer" style="display:none; position:fixed; bottom:0; width:100%; background:#f8f9fa; padding:10px; border-top:1px solid #ccc;">
  <h4>Your Order</h4>
  <ul id="cart-items" style="list-style:none; padding-left:0;"></ul>
  <button id="place-order-btn" class="order-btn">Place Order</button>
</div>

<!-- Modal Container -->
<div id="order-form-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
  <form method="POST" action="" id="order-form" style="background:#fff; padding:20px; border-radius:8px; max-width:400px; width:90%;">
    {% csrf_token %}
    <h4>Order Details</h4>
    <input type="text" name="name" placeholder="Your Name" required style="width:100%; margin-bottom:10px; padding:8px;">
    <input type="text" name="table" placeholder="Table No." required style="width:100%; margin-bottom:10px; padding:8px;">
    <input type="tel" name="phone" placeholder="Phone Number" required style="width:100%; margin-bottom:10px; padding:8px;">
    <input type="hidden" name="items" id="items-input">
    <input type="hidden" name="total_price" id="total-price-input">
    <button type="submit" class="order-btn" style="width:100%; margin-bottom:10px;">Submit Order</button>
    <button type="button" onclick="closeForm()" class="order-btn" style="background:#ccc; width:100%;">Cancel</button>
  </form>
</div>

<style>
  .box-container {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-bottom: 20px;
  }
  .box {
    padding: 10px 20px;
    background: #007bff;
    color: white;
    cursor: pointer;
    border-radius: 5px;
    user-select: none;
    transition: background 0.3s;
  }
  .box:hover {
    background: #0056b3;
  }
  .menu {
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 5px;
  }
  .order-btn {
    background: #28a745;
    color: white;
    border: none;
    padding: 6px 12px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s;
  }
  .order-btn:hover {
    background: #218838;
  }
  .remove-btn {
    background: #dc3545;
    border: none;
    color: white;
    padding: 2px 8px;
    cursor: pointer;
    border-radius: 3px;
    margin-left: 10px;
  }
  .remove-btn:hover {
    background: #c82333;
  }
</style>

<script>
  const cart = [];

  function showMenu(id) {
    document.querySelectorAll('.menu').forEach(menu => menu.style.display = 'none');
    const activeMenu = document.getElementById(id);
    if (activeMenu) {
      activeMenu.style.display = 'block';
      activeMenu.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  function addToCart(name, price) {
    if (!cart.find(item => item.name === name)) {
      cart.push({ name, price });
      renderCart();
    }
  }

  function renderCart() {
    const cartList = document.getElementById('cart-items');
    const cartFooter = document.getElementById('cart-footer');
    cartList.innerHTML = '';

    if (cart.length === 0) {
      cartFooter.style.display = 'none';
      return;
    }

    cartFooter.style.display = 'block';
    cart.forEach((item, index) => {
      const li = document.createElement('li');
      li.innerHTML = `
        <span>${item.name} - ₹${item.price}</span>
        <button aria-label="Remove ${item.name}" class="remove-btn" onclick="removeItem(${index})">Remove</button>
      `;
      cartList.appendChild(li);
    });
  }

  function removeItem(index) {
    cart.splice(index, 1);
    renderCart();
  }

  document.getElementById('place-order-btn').addEventListener('click', () => {
    if(cart.length === 0) {
      alert('Your order is empty!');
      return;
    }

    const itemList = cart.map(item => `${item.name} (₹${item.price})`).join(', ');
    const total = cart.reduce((sum, item) => sum + parseFloat(item.price), 0);

    document.getElementById('items-input').value = itemList;
    document.getElementById('total-price-input').value = total.toFixed(2);

    document.getElementById('order-form-modal').style.display = 'flex';
  });

  function closeForm() {
    document.getElementById('order-form-modal').style.display = 'none';
  }

  // Clear cart and close modal after form submission
  document.getElementById('order-form').addEventListener('submit', () => {
    cart.length = 0;
    renderCart();
    closeForm();
  });
</script>

{% endblock %}
